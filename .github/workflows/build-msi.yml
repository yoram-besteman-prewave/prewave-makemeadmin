name: Build MSI Installer

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Add MSBuild to PATH
      uses: microsoft/setup-msbuild@v2
      
    - name: Setup NuGet
      uses: NuGet/setup-nuget@v2
      
    - name: Install WiX Toolset
      run: choco install wixtoolset -y
        
    - name: Restore NuGet Packages
      run: nuget restore "MakeMeAdmin.sln"
      
    - name: Build All Projects (x64)
      run: msbuild "MakeMeAdmin.sln" /p:Configuration=Release /p:Platform=x64 /m
      
    - name: Build Setup/MSI (x64)
      run: msbuild "Setup\Setup.wixproj" /p:Configuration=Release /p:Platform=x64 /m
      
    - name: Build All Projects (x86)
      run: msbuild "MakeMeAdmin.sln" /p:Configuration=Release /p:Platform=x86 /m
      
    - name: Build Setup/MSI (x86)
      run: msbuild "Setup\Setup.wixproj" /p:Configuration=Release /p:Platform=x86 /m
      
    - name: Find MSI Files
      run: |
        echo "Searching for MSI files:"
        dir /s *.msi
        echo ""
        echo "Contents of Installers directory:"
        if exist Installers dir Installers
        
    - name: Upload x64 MSI
      uses: actions/upload-artifact@v4
      with:
        name: MakeMeAdmin-x64-MSI
        path: "Installers/*x64*.msi"
        
    - name: Upload x86 MSI
      uses: actions/upload-artifact@v4
      with:
        name: MakeMeAdmin-x86-MSI
        path: "Installers/*x86*.msi"
