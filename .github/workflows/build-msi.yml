name: Build MSI Installer

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:  # Allow manual trigger

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Add MSBuild to PATH
      uses: microsoft/setup-msbuild@v2
      
    - name: Setup NuGet
      uses: NuGet/setup-nuget@v2
      
    - name: Install WiX Toolset
      run: |
        choco install wixtoolset -y
        
    - name: Debug - Show Directory Contents
      run: |
        echo "Current directory:"
        pwd
        echo ""
        echo "Files in root:"
        dir
        echo ""
        echo "Looking for solution file:"
        dir *.sln
        
    - name: Restore NuGet Packages
      run: nuget restore "MakeMeAdmin.sln"
      
    - name: Build x64 Release
      run: msbuild "MakeMeAdmin.sln" /p:Configuration=Release /p:Platform=x64 /t:Setup /m
      
    - name: Build x86 Release  
      run: msbuild "MakeMeAdmin.sln" /p:Configuration=Release /p:Platform=x86 /t:Setup /m
      
    - name: Find MSI Files
      run: |
        echo "Searching for MSI files:"
        dir /s *.msi
        
    - name: Upload x64 MSI
      uses: actions/upload-artifact@v4
      with:
        name: MakeMeAdmin-x64-MSI
        path: "**/*x64*.msi"
        
    - name: Upload x86 MSI
      uses: actions/upload-artifact@v4
      with:
        name: MakeMeAdmin-x86-MSI
        path: "**/*x86*.msi"
